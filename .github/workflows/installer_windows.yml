name: Build Installer Windows

on:
  workflow_call:

jobs:
  flatpak:
    runs-on: windows-latest
    steps:
      # Checkout the repo
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
            # Version range or exact version of a Python version to use, using SemVer's version range syntax.
            python-version: 3.9 # optional, default is 3.x
            # The target architecture (x86, x64) of the Python interpreter.
            architecture: x64 # optional

      - name: Install dependencies
        run: python3 -m pip install -r requirements.txt

      - name: Install cx-freeze
        run: python3 -m pip install cx-freeze pyyaml

      - name: Build
        run: |
          copy buildconfig/setup_cx_freeze.py setup_cx_freeze.py
          copy buildconfig/build_config.yaml build_config.yaml
          python setup_cx_freeze.py build

      - name: Install nsis
        run: |
          Invoke-WebRequest -Uri "https://sourceforge.net/projects/nsis/files/NSIS%203/3.10/nsis-3.10-setup.exe" -OutFile "nsis.exe"

      - name: Build Installer
        run: |
          cd buildconfig
          cmd.exe /c "build_installer.bat"
          mkdir ../dist/
          mv tuxemon-installer.exe ../dist/.

      - name: Upload installer
        uses: actions/upload-artifact@v4
        with:
            name: tuxemon_windows_installer
            path: dist
